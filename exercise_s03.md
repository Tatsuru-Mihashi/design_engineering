# デジタルエンジニアリング特論2022/5/26 構造演習3

 ***※※現在作成中の講義資料です。時間を見つけて更新していきます。5/22（日）中までにはおおむねまとめます。内容的にはかなり盛沢山なのであらかじめ予習しておいてください。※※***

## 最適化計算について

最適化計算とは、ある制約条件の中である目的関数を最小化もしくは最大化する設計変数を探索する事です。

例えば、第1回の課題の単純梁において、以下のような最適化問題を定義できます。

目的関数：鉄骨重量の最小化

設計変数：鉄骨断面寸法

制約条件：変形角1/250以下・長期許容応力度以下

このような簡単な問題であればコンピューターに頼ることなく手計算でも計算可能です。

実際は構造設計の最適化における設計変数は多岐にわたり、無数といっても過言ではありません。
構造設計における最適化計算は古くからある技術ですが、最近でこそ大手ゼネコンや設計事務所が取り取り組み始めているものの、実務設計において本格的な最適化計算が行われるケースは極めて稀です。

現時点で構造設計で最適化計算を行うには、構造解析プログラムを外から操作する最適化ツールを購入するか、自ら開発するかの選択となります。（近い将来ソフトメーカーからも販売されるものと思いますが、自由度はかなり限られると思います。）いずれも一長一短があり、一般的に普及するにはまだ時間を要すると思います。

grasshopperにおける最適化計算は比較的容易に検討できますが、、実務ベースでは解析速度が課題となります。複雑な問題の最適化計算では結果を得るのに相当の時間を要します。

実施設計の中で限られたリソースと時間の中で最適化設計を行う際は、まず設計者の感覚・経験に基づいて設計変数を縮約することが重要です。

<!-- 構造設計における最適化計算には様々の種類が考えられます。
例えば、部材寸法の最適化、部材配置の最適化、架構形状の最適化などが想像がつきます。-->

---
## 演習課題3(片持トラス梁の最適化計算)

長さ20mの片持ち梁の最適化を行います。上弦材及び下弦材の間のトラス材（斜材及び束材）の配置を最適化することで、梁の総重量を最小化します。トラス材の両端部はピン接合とします。

最大変形が変形角1/100以下(最大変形20cm以下)であることを条件とし、簡略化のため応力度については特に制限を設けません。（鉄骨造は一般的に応力度ではなく、変形（剛性）で形状が決まることも多いです。）

### 架構形状

![](img/2022-05-20-15-30-10.png)

基点

点A( 0.0, 0.0, 0.0)

点C( 0.0, 0.0, -2.5)

先端

点B(20.0, 0.0, 0.0)

点D(20.0, 0.0, -2.5)

上弦材はABを結ぶ直線、下弦材はACを結ぶ直線とし、端部は剛接合とします。上弦材・下弦材の断面は円形鋼管〇-300x12(SN400)とします。

AB間およびAC間をそれぞれ4等分し節点を設け、上弦材上の節点と下弦材上の節点を総当たりで結んだ線のうち選択したものをトラス材として解析に使用します。トラス材の端部はピン接合とします。トラス材の断面は円形鋼管〇-100x9(SN400)とします。

このようにして要素の選択を行う最適化手法をグランドストラクチャ法と呼びます。

鋼材SN400のヤング係数はこれまでと同じE=205000N/mm<sup>2</sup>(20500kN/cm<sup>2</sup>)とします。

### 支点

点A及び点Cについて、Tx,Ty,Tz及びRx,Ry,Rz全て固定とします。

### 荷重

積載荷重として上弦材にZ方向下向きの分布荷重30kN/mを作用させます。
また、すべての要素の自重を考慮することにします。

---

## 解答例

### コンポーネントの配置

コンポーネントの配置例の全体図を以下に示します。

![](2022-05-20-21-07-48.png)

#### 架構の描画

##### 上・下弦材

節点Aと節点Bを定義し、AB間を上弦材として描画します。DivideCurveコンポーネントでAB間を等分し、Shutterコンポーネントで直線も分割します。
下弦材は上弦材を2.5m下にMoveコンポーネントで移動させます。(grasshopperではMoveコンポーネントはMove前のジオメトリも残りますので、実質コピーとなります。)

##### トラス材

上弦材及び下弦材を分割した節点が格納されたデータのどちらの片方データをGraftしてLINEコンポーネントで結びます。（Graftすると片方のデータが一つのBranchに）
そうすると上下の節点間で総当たりの線が引けます。節点は5点ずつありますので、トラス材計25本の線が引かれます。

全てのトラス材を格納したLineコンポーネントをDispatchコンポーネントのList入力端子に接続します。このコンポーネントはPattern端子に入力されたBOOL値(1か0)でジオメトリの有無を定義します。

今回の演習ではトラス材の有無を設計変数としますので、GenePoolコンポーネントを配置し、遺伝子数を25個に設定し、Pattern端子に接続します。A端子の場合はTrue(1)が設定されたジオメトリが出力され、B端子の場合はFalse(0)が設定されたジオメトリが出力されます。

入力端子Listの接続部分で、Flattenしておきます。（Flattenしないとbranch毎にトラスの有無が設定されてしまいます。）

![](2022-05-20-21-09-28.png)


#### 梁要素と荷重の定義

分布荷重は上弦材のみに作用させますので、LineToBeamコンポーネントは上弦材用、下弦材用、トラス材用の3つを配置します。
トラス材はBendingの入力端子にFalseを設定します。（Trueで両端剛接合、Falseで両端ピン接合が設定されます。）

このうち上弦材のみに荷重を作用させるので、IDに名称を付けます。このIDは分布荷重にも同じIDをつけておきます。

![](img/2022-05-19-21-20-49.png)

![](img/2022-05-20-14-53-17.png)

自重を考慮するのでLoadsコンポーネントのGravityを設定し、Z方向下向きの荷重を作用させます。
要素の比重はMaterialPropertyコンポーネントのgammaで必要に応じて定義します。今回は鋼材の標準値78.5kN/m<sup>3</sup>で計算します。


![](2022-05-20-21-12-17.png)

#### 解析モデルの構築

梁要素、支点、荷重条件AssembleModelコンポーネントに接続します。
下部の支点は下限材の節点から0番目をListItemコンポーネントで取り出します。
その際に、それぞれをFlattenしてデータ構造の階層をなくしておきます。（階層があると複数の解析モデルで解析が実行されてしまいます。）

![](2022-05-20-21-14-10.png)

#### 最適化

この例ではgrasshopper標準で搭載されているGalapagosというコンポーネントを使用します。

このコンポーネントでは遺伝的アルゴリズム(Genetic Algorithm 略称GA)及び焼きなまし法(Simulated Annealing 略称SA)による最適化計算を行うことが可能です。今回はGAによる最適化を行います。
GAは設計変数を遺伝子とみなし、その組み合わせを生物の個体に見立てます。1世代あたり決められた個体数の集団を生成、評価し、優良な個体を残して次の世代の集団を生成するという仕組みです。

架構重量はAssembleModelコンポーネントのMass端子から取り出し、これを最小化する目的関数とします。

最大変形はAnalyzeコンポーネントのDisp端子から取り出します。以下のGHPythonコンポーネントで、変形が許容値の10cmを超えたら重量を増やすペナルティを与えることで制約条件を満足させます。入力変数としてdisp,massを設定し、出力変数としてmassを設定します。

```python
if disp > 20:
    mass = mass * 2
```

Galapagosをダブルクリックすると設定画面が表示されます。今回は鋼材重量の最小化を目的関数としていますので、Fitnessの設定をMinimizeとします。

・Max.Stagnant 停滞世代数（この世代数最適解が更新されなければ最適化を終了）
・Population 個体数
・Maintain 選択率
・Inbreeding 交配率

![](img/2022-05-20-10-04-46.png)

その他の設定はDefaultのままとして、SolversタブのStartSolverボタンで最適化が開始されます。

荷重条件によって、必要なトラス材の組み合わせが変わります。いくつか条件を変えてみて確認してみましょう。荷重を大きくしすぎると、最適解が見つからない可能性もあります。

今回のトラス配置の総組合せ数は2<sup>25</sup>=3355万通りあります。全部の組合せ数について検討を行えば、必ず最適解が見つかりますが、1回の解析に1msec(=0.001sec)を要したとすれば、33554sec=9時間以上の計算時間が必要となります。最適化アルゴリズムを用いることで効率的に解が得られることがわかると思います。


